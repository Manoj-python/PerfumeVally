{% load crispy_forms_tags %}

<form id="editproductForm-{{ product.id }}" enctype="multipart/form-data">
  {% csrf_token %}
  <div class="modal-body">
    <h5 class="mb-3">Product Details</h5>
    <div class="row">
      {% for field in form %}
        <div class="col-md-6 mb-3">
          {{ field|as_crispy_field }}
        </div>
      {% endfor %}
    </div>

    <!-- Variants -->
    <div id="variant-formset-{{ product.id }}">
      <h5 class="mb-3">Product Variants</h5>
      {{ variant_formset.management_form }}
      <div id="variant-forms-{{ product.id }}">
        {% for form in variant_formset %}
          <div class="variant-form border rounded p-3 mb-3">
            <div class="row">
              {{ form.id }}
              {% for field in form.visible_fields %}
                <div class="col-md-6 mb-3">{{ field|as_crispy_field }}</div>
              {% endfor %}
            </div>
            <button type="button" class="remove-variant btn btn-outline-danger btn-sm">✖ Remove Variant</button>
          </div>
        {% endfor %}
      </div>

      <div id="variant-empty-form-{{ product.id }}" class="d-none">
        <div class="variant-form border rounded p-3 mb-3">
          <div class="row">
            {% for field in variant_formset.empty_form.visible_fields %}
              <div class="col-md-6 mb-3">{{ field|as_crispy_field }}</div>
            {% endfor %}
          </div>
          <button type="button" class="remove-variant btn btn-outline-danger btn-sm">✖ Remove Variant</button>
        </div>
      </div>
      <a href="#" id="add-variant-{{ product.id }}" class="add-variant-link mt-2">➕ Add Another Variant</a>
    </div>

    <!-- Giftsets -->
    <div id="giftset-formset-{{ product.id }}" style="display: none;">
      <h5 class="mb-3">Giftsets</h5>
      {{ giftset_formset.management_form }}
      <div id="giftset-forms-{{ product.id }}">
        {% for form in giftset_formset %}
          <div class="giftset-form border rounded p-3 mb-3">
            <div class="row">
              {{ form.id }}
              {% for field in form.visible_fields %}
                <div class="col-md-6 mb-3">{{ field|as_crispy_field }}</div>
              {% endfor %}
            </div>
            <button type="button" class="remove-giftset btn btn-outline-danger btn-sm">✖ Remove Giftset</button>
          </div>
        {% endfor %}
      </div>

      <div id="giftset-empty-form-{{ product.id }}" class="d-none">
        <div class="giftset-form border rounded p-3 mb-3">
          <div class="row">
            {% for field in giftset_formset.empty_form.visible_fields %}
              <div class="col-md-6 mb-3">{{ field|as_crispy_field }}</div>
            {% endfor %}
          </div>
          <button type="button" class="remove-giftset btn btn-outline-danger btn-sm">✖ Remove Giftset</button>
        </div>
      </div>
      <a href="#" id="add-giftset-{{ product.id }}" class="add-giftset-link mt-2">➕ Add Another Giftset</a>
    </div>
  </div>

  <div class="modal-footer">
    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Cancel</button>
    <button type="submit" class="btn btn-maroon">Update Product</button>
  </div>
</form>
